- name: Install dependencies
  hosts: 127.0.0.1
  connection: local
  tasks:
    - name: Run ansible galaxy
      command: ansible-galaxy install -r requirements.yml
      register: galaxy_result
      changed_when: '"was installed successfully" in galaxy_result.stdout'

- name: Docker
  hosts: all
  tasks:
    - block:
        - name: Install Docker
          include_role:
            name: ansible-role-docker
          vars:
            docker_install_compose: false
            docker_users:
              - '{{ ansible_ssh_user }}'
      become: true

    - name: Restart a container
      community.general.docker_container:
        name: monorail-api
        image: docker.pkg.github.com/melalex/monorail/api:{{ monorail_version }}
        state: started
        restart: yes
        ports:
          - "8080:8080"
